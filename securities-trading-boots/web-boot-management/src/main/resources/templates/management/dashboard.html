<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{common/layout :: layout(
      title = '系统管理控制台',
      css = ~{::css},
      content = ~{::content},
      js = ~{::js}
    )}">

<th:block th:fragment="css">
    <style>
        .dashboard-card {
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .stat-card {
            border-left: 4px solid;
        }
        .card-primary {
            border-left-color: #007bff;
        }
        .card-success {
            border-left-color: #28a745;
        }
        .card-info {
            border-left-color: #17a2b8;
        }
        .card-warning {
            border-left-color: #ffc107;
        }
        .card-danger {
            border-left-color: #dc3545;
        }
    </style>
</th:block>

<th:block th:fragment="content">
<div class="container-fluid">
    <!-- 用户信息卡片 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0" th:text="${currentUser.realName ?: currentUser.username}">
                                欢迎回来，管理员
                            </h4>
                            <p class="mb-0" th:text="${currentUser.email ?: currentUser.userCode}">
                                admin@example.com
                            </p>
                        </div>
                        <div class="text-end">
                            <h5 class="mb-0">系统管理控制台</h5>
                            <small>金融交易系统</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 快捷操作卡片 -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card dashboard-card stat-card card-primary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">用户管理</h5>
                            <p class="card-text">管理系统用户</p>
                        </div>
                        <div class="fs-2">
                            <i class="bi bi-people text-primary"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a th:href="@{/system/user/list}" class="btn btn-sm btn-primary">
                        进入管理 <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card dashboard-card stat-card card-success h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">角色管理</h5>
                            <p class="card-text">管理用户角色</p>
                        </div>
                        <div class="fs-2">
                            <i class="bi bi-shield-check text-success"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a th:href="@{/system/role/list}" class="btn btn-sm btn-success">
                        进入管理 <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card dashboard-card stat-card card-info h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">权限管理</h5>
                            <p class="card-text">管理系统权限</p>
                        </div>
                        <div class="fs-2">
                            <i class="bi bi-key text-info"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a th:href="@{/system/permission/list}" class="btn btn-sm btn-info">
                        进入管理 <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card dashboard-card stat-card card-warning h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">参数管理</h5>
                            <p class="card-text">管理系统参数</p>
                        </div>
                        <div class="fs-2">
                            <i class="bi bi-gear text-warning"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a th:href="@{/system/parameter/list}" class="btn btn-sm btn-warning">
                        进入管理 <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统信息卡片 -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">登录信息</h5>
                    <i class="bi bi-info-circle"></i>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td class="fw-bold" style="width: 40%">用户名：</td>
                            <td th:text="${currentUser.username}">admin</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">用户编码：</td>
                            <td th:text="${currentUser.userCode}">ADMIN</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">真实姓名：</td>
                            <td th:text="${currentUser.realName}">系统管理员</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">邮箱：</td>
                            <td th:text="${currentUser.email ?: '未设置'}">admin@example.com</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">手机号：</td>
                            <td th:text="${currentUser.phone ?: '未设置'}">13800138000</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">用户状态：</td>
                            <td>
                                <span class="badge bg-success" th:if="${currentUser.status == 1}">启用</span>
                                <span class="badge bg-danger" th:if="${currentUser.status != 1}">禁用</span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">用户权限</h5>
                    <i class="bi bi-shield-check"></i>
                </div>
                <div class="card-body">
                    <div sec:authorize="hasAuthority('ROLE_ADMIN') or hasAuthority('ADMIN')">
                        <div class="alert alert-success">
                            <i class="bi bi-shield-fill me-2"></i>
                            您拥有管理员权限，可以访问所有系统功能
                        </div>
                    </div>
                    
                    <h6>角色列表：</h6>
                    <ul class="list-group list-group-flush" th:with="userRoles=${#authentication.principal.authorities}">
                        <li class="list-group-item d-flex justify-content-between align-items-center" 
                            th:each="auth : ${userRoles}" 
                            th:if="${auth.authority.startsWith('ROLE_')}">
                            <span th:text="${#strings.substring(auth.authority, 5)}">ROLE_ADMIN</span>
                            <span class="badge bg-primary rounded-pill">角色</span>
                        </li>
                        <li class="list-group-item text-muted" th:if="${#lists.size(userRoles) == 0}">
                            未分配任何角色
                        </li>
                    </ul>
                    
                    <h6 class="mt-3">权限列表：</h6>
                    <ul class="list-group list-group-flush" th:with="userPermissions=${#authentication.principal.authorities}">
                        <li class="list-group-item d-flex justify-content-between align-items-center" 
                            th:each="auth : ${userPermissions}" 
                            th:unless="${auth.authority.startsWith('ROLE_')}">
                            <span th:text="${auth.authority}">PERMISSION_MANAGE_USERS</span>
                            <span class="badge bg-info rounded-pill">权限</span>
                        </li>
                        <li class="list-group-item text-muted" th:if="${#lists.size(userPermissions) == 0}">
                            未分配任何权限
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
</th:block>

<th:block th:fragment="js">
<script>
$(document).ready(function() {
    // 计算各个模块卡片的高度，保持一致
    function equalizeCardHeights() {
        let maxHeight = 0;
        $('.dashboard-card').each(function() {
            const height = $(this).outerHeight();
            if (height > maxHeight) {
                maxHeight = height;
            }
        });
        
        $('.dashboard-card').css('height', maxHeight);
    }
    
    // 页面加载完成后执行一次
    equalizeCardHeights();
    
    // 窗口大小改变时重新计算
    $(window).resize(function() {
        equalizeCardHeights();
    });
});
</script>
</th:block>
</html>