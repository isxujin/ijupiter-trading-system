<!DOCTYPE html>
<html lang="zh-CN" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/layout}">
<head>
    <title>参数详情 - iJupiter Trading System</title>
</head>
<body>
<div layout:fragment="content">
                    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header"><h5 class="card-title mb-0">参数详情</h5></div>
                    <div class="card-body">
                        <dl class="row">
                            <dt class="col-sm-3">参数编码</dt><dd class="col-sm-9" th:text="${parameter.paramCode}"></dd>
                            <dt class="col-sm-3">参数名称</dt><dd class="col-sm-9" th:text="${parameter.paramName}"></dd>
                            <dt class="col-sm-3">参数值</dt><dd class="col-sm-9" th:text="${parameter.paramValue}"></dd>
                            <dt class="col-sm-3">参数类型</dt><dd class="col-sm-9" th:text="${parameter.paramType}"></dd>
                            <dt class="col-sm-3">参数分组</dt><dd class="col-sm-9" th:text="${parameter.paramGroup}"></dd>
                            <dt class="col-sm-3">是否系统参数</dt><dd class="col-sm-9" th:text="${parameter.isSystem == 1 ? '是' : '否'}"></dd>
                            <dt class="col-sm-3">是否可编辑</dt><dd class="col-sm-9" th:text="${parameter.isEditable == 1 ? '是' : '否'}"></dd>
                            <dt class="col-sm-3">默认值</dt><dd class="col-sm-9" th:text="${parameter.defaultValue}"></dd>
                            <dt class="col-sm-3">排序号</dt><dd class="col-sm-9" th:text="${parameter.sortOrder}"></dd>
                            <dt class="col-sm-3">描述</dt><dd class="col-sm-9" th:text="${parameter.description}"></dd>
                        </dl>
                        <div class="d-flex justify-content-end">
                            <a th:href="@{/system/parameter/list}" class="btn btn-outline-secondary me-2">返回列表</a>
                            <a th:href="@{/system/parameter/edit/{id}(id=${parameter.id})}" class="btn btn-primary me-2">编辑</a>
                            <button class="btn btn-warning me-2" id="resetBtn" th:if="${parameter.isEditable == 1 and parameter.defaultValue != null}">重置为默认值</button>
                            <button class="btn btn-secondary" id="toggleEnableBtn" th:text="${parameter.isEditable == 1 ? '禁用编辑' : '启用编辑'}" th:if="${parameter.isSystem != 1}"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header"><h6 class="mb-0">其他信息</h6></div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2"><strong>创建时间: </strong><span th:text="${#temporals.format(parameter.createTime, 'yyyy-MM-dd HH:mm:ss')}">-</span></div>
                                <div class="mb-2"><strong>最后修改人: </strong><span th:text="${parameter.lastModifier ?: '-'}">-</span></div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2"><strong>更新时间: </strong><span th:text="${#temporals.format(parameter.updateTime, 'yyyy-MM-dd HH:mm:ss')}">-</span></div>
                                <div class="mb-2"><strong>版本号: </strong><span th:text="${parameter.version ?: 1}">1</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="js">
    <script src="/js/system-ui.js"></script>
    <script>
        (function(){
            const id = /*[[${parameter.id}]]*/ 0;
            function showMessage(msg, type){ if(window.showToast) window.showToast(type==='error'?'error':type, msg); else alert(msg); }

            const resetBtn = document.getElementById('resetBtn');
            if(resetBtn){ resetBtn.addEventListener('click', async function(){ if(!confirm('确定要重置此参数为默认值吗？')) return; try{ const resp = await fetch('/system/parameter/reset/' + id, { method:'POST' }); const res = await resp.json(); if(res.code===200){ showMessage('重置成功','success'); setTimeout(()=>location.reload(),700); } else showMessage('重置失败: '+res.message,'error'); } catch(e){ console.error(e); showMessage('重置失败','error'); } }); }

            const toggleBtn = document.getElementById('toggleEnableBtn');
            if(toggleBtn){ toggleBtn.addEventListener('click', async function(){ const enabled = /*[[${parameter.isEditable == 1}]]*/ true; const confirmMsg = enabled ? '确定要禁用此参数的编辑吗？' : '确定要启用此参数的编辑吗？'; if(!confirm(confirmMsg)) return; try{ const resp = await fetch('/system/parameter/toggleEditable/' + id, { method:'POST' }); const res = await resp.json(); if(res.code===200){ showMessage('操作成功','success'); setTimeout(()=>location.reload(),700); } else showMessage('操作失败: '+res.message,'error'); } catch(e){ console.error(e); showMessage('操作失败','error'); } }); }
        })();
    </script>
    </th:block>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>